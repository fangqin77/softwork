import{d as z,n as F,r as u,j as b,p as I,o as R,q as V,c as o,a as s,k as q,t as r,u as j,x as g,F as x,h as E,s as _,y as M,i as n,_ as T}from"./index-aoWYAbzc.js";const U={class:"club-detail"},G={key:0,class:"loading"},H={key:1,class:"club-content"},J={class:"club-header"},K={class:"club-basic-info"},O=["src","alt"],P={class:"club-text-info"},Q={class:"category"},W={class:"contact"},X={class:"intro"},Y={class:"tabs"},Z={class:"activities-section"},tt={key:0,class:"loading"},et={key:1,class:"no-activities"},st={key:2,class:"activities-grid"},at=["onClick"],lt=["src","alt"],ot={class:"activity-info"},nt={class:"activity-time"},rt={class:"activity-location"},it={class:"activity-status"},ct={key:0,class:"admin-section"},ut={class:"admin-actions"},dt={key:2,class:"not-found"},vt=z({__name:"ClubDetail",setup(_t){const m=I(),D=M(),i=F(),a=u(null),y=u([]),d=u([]),f=u(!0),p=u(!1),c=u("current"),v=b(()=>m.params.id),L=b(()=>!i.user||!a.value?!1:i.user.role==="club_admin"),h=b(()=>d.value.some(t=>t.target_type==="club"&&t.target_id===v.value)),k=b(()=>y.value.filter(t=>c.value==="current"?t.status==="pending"||t.status==="ongoing":t.status==="completed"||t.status==="cancelled")),S=t=>({academic:"学术类",art:"文艺类",sports:"体育类",public_welfare:"公益类",other:"其他"})[t]||t,A=t=>({pending:"待开始",ongoing:"进行中",completed:"已完成",cancelled:"已取消"})[t]||t,B=t=>new Date(t).toLocaleString("zh-CN"),C=async()=>{try{f.value=!0;const{data:t,error:e}=await _.from("clubs").select("*").eq("id",v.value).single();if(e)throw e;a.value=t}catch(t){console.error("获取社团详情失败:",t),a.value=null}finally{f.value=!1}},w=async()=>{if(a.value)try{p.value=!0;const{data:t,error:e}=await _.from("activities").select("*").eq("club_id",a.value.id).order("activity_time",{ascending:!1});if(e)throw e;y.value=t||[]}catch(t){console.error("获取社团活动失败:",t)}finally{p.value=!1}},$=async()=>{if(i.user)try{const{data:t,error:e}=await _.from("collections").select("*").eq("user_id",i.user.id);if(e)throw e;d.value=t||[]}catch(t){console.error("获取收藏列表失败:",t)}},N=async()=>{if(!i.user){D.push("/login");return}try{if(h.value){const{error:t}=await _.from("collections").delete().eq("user_id",i.user.id).eq("target_type","club").eq("target_id",v.value);if(t)throw t;d.value=d.value.filter(e=>!(e.target_type==="club"&&e.target_id===v.value))}else{const{data:t,error:e}=await _.from("collections").insert({user_id:i.user.id,target_type:"club",target_id:v.value}).select().single();if(e)throw e;d.value.push(t)}}catch(t){console.error("操作收藏失败:",t)}};return R(async()=>{await C(),a.value&&(await w(),await $())}),V(()=>m.params.id,async()=>{await C(),a.value&&(await w(),await $())}),(t,e)=>(n(),o("div",U,[f.value?(n(),o("div",G,"加载中...")):a.value?(n(),o("div",H,[s("div",J,[s("div",K,[s("img",{src:a.value.logo_url,alt:a.value.name,class:"club-logo"},null,8,O),s("div",P,[s("h1",null,r(a.value.name),1),s("p",Q,r(S(a.value.category)),1),s("p",W,"联系方式: "+r(a.value.contact),1),s("p",X,r(a.value.intro),1),j(i).user?(n(),o("button",{key:0,onClick:N,class:g(["collect-btn",{collected:h.value}])},r(h.value?"已收藏":"收藏社团"),3)):q("",!0)])])]),s("div",Y,[s("button",{class:g(["tab",{active:c.value==="current"}]),onClick:e[0]||(e[0]=l=>c.value="current")}," 当前活动 ",2),s("button",{class:g(["tab",{active:c.value==="past"}]),onClick:e[1]||(e[1]=l=>c.value="past")}," 过往活动 ",2)]),s("div",Z,[p.value?(n(),o("div",tt,"加载活动中...")):k.value.length===0?(n(),o("div",et,[s("p",null,"暂无"+r(c.value==="current"?"当前":"过往")+"活动",1)])):(n(),o("div",st,[(n(!0),o(x,null,E(k.value,l=>(n(),o("div",{key:l.id,class:"activity-card",onClick:bt=>t.$router.push(`/activities/${l.id}`)},[s("img",{src:l.poster_url,alt:l.title,class:"activity-poster"},null,8,lt),s("div",ot,[s("h3",null,r(l.title),1),s("p",nt,r(B(l.activity_time)),1),s("p",rt,r(l.location),1),s("p",it,r(A(l.status)),1)])],8,at))),128))]))]),L.value?(n(),o("div",ct,[e[5]||(e[5]=s("h3",null,"社团管理",-1)),s("div",ut,[s("button",{onClick:e[2]||(e[2]=l=>t.$router.push(`/clubs/${a.value.id}/edit`)),class:"btn btn-primary"}," 编辑社团信息 "),s("button",{onClick:e[3]||(e[3]=l=>t.$router.push("/activities/create")),class:"btn btn-secondary"}," 发布新活动 ")])])):q("",!0)])):(n(),o("div",dt,[e[6]||(e[6]=s("h2",null,"社团不存在",-1)),s("button",{onClick:e[4]||(e[4]=l=>t.$router.push("/clubs")),class:"btn btn-primary"},"返回社团列表")]))]))}}),pt=T(vt,[["__scopeId","data-v-7bccb59a"]]);export{pt as default};
