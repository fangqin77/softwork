import{d as P,n as S,r as g,c as t,a as r,z as V,l as d,k as n,v as m,x as v,t as u,m as U,f as c,e as x,w as q,g as h,y as C,i,s as w,_ as D}from"./index-aoWYAbzc.js";const E={class:"register-page"},N={class:"register-container"},R={class:"form-group"},B={key:0,class:"error-message"},I={class:"form-group"},M={key:0,class:"error-message"},O={class:"form-group"},z={key:0,class:"error-message"},T={class:"form-group"},j={key:0,class:"error-message"},F={class:"form-group"},A={key:0,class:"error-message"},G={class:"form-group"},H={key:0,class:"error-message"},J={class:"form-group"},K={key:0,class:"error-message"},L=["disabled"],Q={class:"login-link"},W=P({__name:"Register",setup(X){const y=C(),_=S(),p=g(!1),s=g({email:"",password:"",confirmPassword:"",username:"",college:"",grade:"",role:""}),a=g({email:"",password:"",confirmPassword:"",username:"",college:"",grade:"",role:""}),b=()=>{Object.keys(a.value).forEach(e=>{a.value[e]=""});let l=!0;return s.value.email?/\S+@\S+\.\S+/.test(s.value.email)||(a.value.email="请输入有效的邮箱地址",l=!1):(a.value.email="请输入邮箱地址",l=!1),s.value.password?s.value.password.length<6&&(a.value.password="密码长度至少6位",l=!1):(a.value.password="请输入密码",l=!1),s.value.confirmPassword?s.value.password!==s.value.confirmPassword&&(a.value.confirmPassword="两次输入的密码不一致",l=!1):(a.value.confirmPassword="请确认密码",l=!1),s.value.username||(a.value.username="请输入昵称",l=!1),s.value.college||(a.value.college="请输入学院",l=!1),s.value.grade||(a.value.grade="请输入年级",l=!1),s.value.role||(a.value.role="请选择身份",l=!1),l},k=async()=>{if(b())try{p.value=!0;const{data:l,error:e}=await w.auth.signUp({email:s.value.email,password:s.value.password});if(e)throw e;if(l.user){const{error:f}=await w.from("profiles").update({username:s.value.username,college:s.value.college,grade:s.value.grade,role:s.value.role}).eq("id",l.user.id);if(f)throw f;_.setUser({id:l.user.id,email:s.value.email,username:s.value.username,avatar_url:"https://picsum.photos/200",college:s.value.college,grade:s.value.grade,role:s.value.role,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),alert("注册成功！请检查邮箱验证邮件。"),y.push("/")}}catch(l){console.error("注册失败:",l),l.message.includes("User already registered")?alert("该邮箱已被注册"):alert("注册失败，请重试")}finally{p.value=!1}};return(l,e)=>{const f=h("router-link");return i(),t("div",E,[r("div",N,[e[17]||(e[17]=r("div",{class:"register-header"},[r("h2",null,"注册账号"),r("p",null,"加入校园社团活动平台")],-1)),r("form",{onSubmit:V(k,["prevent"]),class:"register-form"},[r("div",R,[e[7]||(e[7]=r("label",{for:"email"},"邮箱",-1)),d(r("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=o=>s.value.email=o),type:"email",required:"",placeholder:"请输入邮箱地址",class:v({error:a.value.email})},null,2),[[m,s.value.email]]),a.value.email?(i(),t("span",B,u(a.value.email),1)):n("",!0)]),r("div",I,[e[8]||(e[8]=r("label",{for:"password"},"密码",-1)),d(r("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=o=>s.value.password=o),type:"password",required:"",placeholder:"请输入密码（至少6位）",class:v({error:a.value.password})},null,2),[[m,s.value.password]]),a.value.password?(i(),t("span",M,u(a.value.password),1)):n("",!0)]),r("div",O,[e[9]||(e[9]=r("label",{for:"confirmPassword"},"确认密码",-1)),d(r("input",{id:"confirmPassword","onUpdate:modelValue":e[2]||(e[2]=o=>s.value.confirmPassword=o),type:"password",required:"",placeholder:"请再次输入密码",class:v({error:a.value.confirmPassword})},null,2),[[m,s.value.confirmPassword]]),a.value.confirmPassword?(i(),t("span",z,u(a.value.confirmPassword),1)):n("",!0)]),r("div",T,[e[10]||(e[10]=r("label",{for:"username"},"昵称",-1)),d(r("input",{id:"username","onUpdate:modelValue":e[3]||(e[3]=o=>s.value.username=o),type:"text",required:"",placeholder:"请输入昵称",class:v({error:a.value.username})},null,2),[[m,s.value.username]]),a.value.username?(i(),t("span",j,u(a.value.username),1)):n("",!0)]),r("div",F,[e[11]||(e[11]=r("label",{for:"college"},"学院",-1)),d(r("input",{id:"college","onUpdate:modelValue":e[4]||(e[4]=o=>s.value.college=o),type:"text",required:"",placeholder:"请输入学院",class:v({error:a.value.college})},null,2),[[m,s.value.college]]),a.value.college?(i(),t("span",A,u(a.value.college),1)):n("",!0)]),r("div",G,[e[12]||(e[12]=r("label",{for:"grade"},"年级",-1)),d(r("input",{id:"grade","onUpdate:modelValue":e[5]||(e[5]=o=>s.value.grade=o),type:"text",required:"",placeholder:"请输入年级（如：2022级）",class:v({error:a.value.grade})},null,2),[[m,s.value.grade]]),a.value.grade?(i(),t("span",H,u(a.value.grade),1)):n("",!0)]),r("div",J,[e[14]||(e[14]=r("label",{for:"role"},"身份",-1)),d(r("select",{id:"role","onUpdate:modelValue":e[6]||(e[6]=o=>s.value.role=o),required:"",class:v({error:a.value.role})},[...e[13]||(e[13]=[r("option",{value:""},"请选择身份",-1),r("option",{value:"student"},"学生",-1),r("option",{value:"club_admin"},"社团管理员",-1)])],2),[[U,s.value.role]]),a.value.role?(i(),t("span",K,u(a.value.role),1)):n("",!0)]),r("button",{type:"submit",class:"register-btn",disabled:p.value},u(p.value?"注册中...":"注册"),9,L)],32),r("div",Q,[r("p",null,[e[16]||(e[16]=c("已有账号？",-1)),x(f,{to:"/login"},{default:q(()=>[...e[15]||(e[15]=[c("立即登录",-1)])]),_:1})])])])])}}}),Z=D(W,[["__scopeId","data-v-c3ca5e27"]]);export{Z as default};
